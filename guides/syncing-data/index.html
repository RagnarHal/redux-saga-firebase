<!DOCTYPE html><html><head><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="ie=edge"/><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/><link rel="preload" href="/redux-saga-firebase/component---src-layouts-index-js-09b7634bc0de54fb20dc.js" as="script"/><link rel="preload" href="/redux-saga-firebase/component---src-layouts-guide-js-a595dc229e1f595c8f3f.js" as="script"/><link rel="preload" href="/redux-saga-firebase/path---guides-syncing-data-d377eb2c5ef2ff9d3444.js" as="script"/><link rel="preload" href="/redux-saga-firebase/app-f3a296a33b4cd35f3b2c.js" as="script"/><link rel="preload" href="/redux-saga-firebase/commons-95f0d9279a1f8fa48b42.js" as="script"/><style type="text/css" data-styled-components="eAQRyg iRtXIr" data-styled-components-is-local="true">/* sc-component-id: sc-bdVaJa */

.iRtXIr{margin:3rem 0;}
/* sc-component-id: sc-bwzfXH */

.eAQRyg{height:1em;}
</style><title data-react-helmet="true">Redux Saga Firebase</title><link data-react-helmet="true" rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/semantic-ui/2.2.12/semantic.min.css"/><link data-react-helmet="true" rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.11.0/themes/prism.css"/><meta data-react-helmet="true" name="description" content="Sample"/><meta data-react-helmet="true" name="keywords" content="sample, something"/><script data-react-helmet="true" async="" defer="" src="https://buttons.github.io/buttons.js"></script><style id="gatsby-inlined-css">body{padding:0}#sidebar{position:-webkit-sticky;position:sticky;top:1.5rem}.four.wide.column{min-height:100vh}.twelve.wide.column{margin-top:2rem!important}:not(pre)>code{background-color:rgba(27,31,35,.05);border-radius:3px;font-size:90%;padding:.2em .5em}</style></head><body><div id="___gatsby"><div class="ui container" data-reactroot=""><div class="ui grid"><div class="four wide column"><div id="sidebar"><h1 class="ui header">Redux Saga Firebase</h1><p>A <a href="https://github.com/redux-saga/redux-saga/">redux-saga</a> integration for <a href="https://firebase.google.com/">firebase</a>.</p><div role="list" class="ui list"><div role="listitem" class="item"><img src="data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0idXRmLTgiPz4KPCEtLSBHZW5lcmF0b3I6IEFkb2JlIElsbHVzdHJhdG9yIDE4LjEuMSwgU1ZHIEV4cG9ydCBQbHVnLUluIC4gU1ZHIFZlcnNpb246IDYuMDAgQnVpbGQgMCkgIC0tPgo8c3ZnIHZlcnNpb249IjEuMSIgaWQ9IkxheWVyXzEiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgeG1sbnM6eGxpbms9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkveGxpbmsiIHg9IjBweCIgeT0iMHB4IgoJIHZpZXdCb3g9IjAgMCAzNiAzNiIgZW5hYmxlLWJhY2tncm91bmQ9Im5ldyAwIDAgMzYgMzYiIHhtbDpzcGFjZT0icHJlc2VydmUiPgo8cGF0aCBmaWxsLXJ1bGU9ImV2ZW5vZGQiIGNsaXAtcnVsZT0iZXZlbm9kZCIgZmlsbD0iIzE5MTcxNyIgZD0iTTE4LDEuNEM5LDEuNCwxLjcsOC43LDEuNywxNy43YzAsNy4yLDQuNywxMy4zLDExLjEsMTUuNQoJYzAuOCwwLjEsMS4xLTAuNCwxLjEtMC44YzAtMC40LDAtMS40LDAtMi44Yy00LjUsMS01LjUtMi4yLTUuNS0yLjJjLTAuNy0xLjktMS44LTIuNC0xLjgtMi40Yy0xLjUtMSwwLjEtMSwwLjEtMQoJYzEuNiwwLjEsMi41LDEuNywyLjUsMS43YzEuNSwyLjUsMy44LDEuOCw0LjcsMS40YzAuMS0xLjEsMC42LTEuOCwxLTIuMmMtMy42LTAuNC03LjQtMS44LTcuNC04LjFjMC0xLjgsMC42LTMuMiwxLjctNC40CgljLTAuMi0wLjQtMC43LTIuMSwwLjItNC4zYzAsMCwxLjQtMC40LDQuNSwxLjdjMS4zLTAuNCwyLjctMC41LDQuMS0wLjVjMS40LDAsMi44LDAuMiw0LjEsMC41YzMuMS0yLjEsNC41LTEuNyw0LjUtMS43CgljMC45LDIuMiwwLjMsMy45LDAuMiw0LjNjMSwxLjEsMS43LDIuNiwxLjcsNC40YzAsNi4zLTMuOCw3LjYtNy40LDhjMC42LDAuNSwxLjEsMS41LDEuMSwzYzAsMi4yLDAsMy45LDAsNC41CgljMCwwLjQsMC4zLDAuOSwxLjEsMC44YzYuNS0yLjIsMTEuMS04LjMsMTEuMS0xNS41QzM0LjMsOC43LDI3LDEuNCwxOCwxLjR6Ii8+Cjwvc3ZnPgo=" class="ui middle aligned image sc-bwzfXH eAQRyg"/><div class="middle aligned content"><a href="https://github.com/n6g7/redux-saga-firebase" target="blank">n6g7 / redux-saga-firebase</a></div></div><div role="listitem" class="item"><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAAklEQVR4AewaftIAAACdSURBVKXBsQmDQBSA4d/HpYikEhsXSGN3bWoHEW4w9/A2EBwgVTqbcIWFjYLJgWmEoPC+L+lgRUFQMmxMlpFayxlT37OEQGTYpNZyb1vOeFYVo/dEgpLhwKuuiW6PB7lz7BkOvJuGn9w59gQlQUlQEpQEJUEp6WDly2QZqbXsjd4TXYqCa1kSTX3PEgKRYbOEwOg9/8zDwDwM7AlKHyBvKXEhUyOHAAAAAElFTkSuQmCC" class="ui middle aligned image sc-bwzfXH eAQRyg"/><div class="middle aligned content"><a href="https://www.npmjs.com/package/redux-saga-firebase" target="blank">redux-saga-firebase</a></div></div></div><div class="ui fluid pointing vertical menu"><div class="red active item"><div class="header">Guides</div><div class="menu"><a href="#" class="red item">Getting started</a><a class="red item" aria-current="false" href="/redux-saga-firebase/guides/custom-keys">Custom keys</a><a class="red item" aria-current="false" href="/redux-saga-firebase/guides/sorting-filtering">Sorting and filtering</a><a class="red item" aria-current="false" href="/redux-saga-firebase/guides/syncing-data">Syncing data</a><a class="red item" aria-current="false" href="/redux-saga-firebase/guides/immutable">Using with Immutable.js</a><a class="red item" aria-current="false" href="/redux-saga-firebase/guides/multiple-apps">Working with multiple apps</a><a href="https://github.com/n6g7/redux-saga-firebase/releases" target="blank" class="red item"><i aria-hidden="true" class="external icon"></i>Release notes</a></div></div><div class="red item"><div class="header">Reference</div><div class="menu"><a class="red item" aria-current="false" href="/redux-saga-firebase/reference/auth">Authentication</a><a class="red item" aria-current="false" href="/redux-saga-firebase/reference/database">Database</a><a class="red item" aria-current="false" href="/redux-saga-firebase/reference/firestore">Firestore</a><a class="red item" aria-current="false" href="/redux-saga-firebase/reference/functions">Functions</a><a class="red item" aria-current="false" href="/redux-saga-firebase/reference/messaging">Messaging</a><a class="red item" aria-current="false" href="/redux-saga-firebase/reference/storage">Storage</a></div></div><div class="red item"><div class="header">Examples</div><div class="menu"><a href="https://redux-saga-firebase.firebaseapp.com/" target="blank" class="red item"><i aria-hidden="true" class="external icon"></i>Web example site</a><a href="https://github.com/n6g7/redux-saga-firebase/tree/master/example" target="blank" class="red item"><i aria-hidden="true" class="external icon"></i>Web example code</a><a href="https://github.com/n6g7/cat/tree/master/rn" target="blank" class="red item"><i aria-hidden="true" class="external icon"></i>React Native example code</a></div></div></div><p><a class="github-button" href="https://github.com/n6g7/redux-saga-firebase" data-icon="octicon-star" data-show-count="true" aria-label="Star n6g7/redux-saga-firebase on GitHub">Star</a><br/><a class="ui image" href="https://circleci.com/gh/n6g7/redux-saga-firebase"><img src="https://circleci.com/gh/n6g7/redux-saga-firebase.svg?style=svg" alt="CircleCI"/></a><br/><a class="ui image" href="https://badge.fury.io/js/redux-saga-firebase"><img src="https://badge.fury.io/js/redux-saga-firebase.svg" alt="npm version"/></a><br/><a class="ui image" href="https://coveralls.io/github/n6g7/redux-saga-firebase?branch=master"><img src="https://coveralls.io/repos/github/n6g7/redux-saga-firebase/badge.svg?branch=master" alt="Coverage Status"/></a><br/><a data-canonical-src="https://snyk.io/test/github/n6g7/redux-saga-firebase" class="ui image" href="https://snyk.io/test/github/n6g7/redux-saga-firebase"><img src="https://snyk.io/test/github/n6g7/redux-saga-firebase/badge.svg" alt="Known Vulnerabilities"/></a></p></div></div><div class="twelve wide column"><div><h1 class="ui header">Syncing data</h1><div><p>Although making synchronisation easy to use is one of the primary goal of this library, there are a few things that are important to understand to avoid common pitfalls.</p>
<p>In this guide we'll implement a data synchronisation saga that supports common scenarios such as:</p>
<ul>
<li>starting and stoping the synchronisation process via actions</li>
<li>handling user login/logout and permissions</li>
</ul>
<p>We'll iterate over several implementations to get to a complete solution.</p>
<div class="ui info message">
  <p class="header">Sagas <=> processes</p>
  <p>
    As always with redux-saga it's helpful to think of sagas as processes, and to understand the difference between <code>fork</code> and <code>exec</code>.
    If you're not already familiar with these concepts already you should read <a href="https://en.wikipedia.org/wiki/Fork%E2%80%93exec">the wikipedia entry</a> as well as <a href="https://redux-saga.js.org/docs/advanced/ForkModel.html">redux-saga's fork model doc</a> before continuing with this guide.
  </p>
</div>
<h2>Starting point</h2>
<p>This is the simplest way to synchronize data:</p>
<div class="gatsby-highlight">
      <pre class="language-js"><code class="language-js"><span class="token keyword">function</span> <span class="token operator">*</span> <span class="token function">rootSaga</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">yield</span> <span class="token function">fork</span><span class="token punctuation">(</span>
    rsf<span class="token punctuation">.</span>database<span class="token punctuation">.</span>sync<span class="token punctuation">,</span>
    <span class="token string">'todos'</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span> successActionCreator<span class="token punctuation">:</span> setTodos <span class="token punctuation">}</span>
  <span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre>
      </div>
<p>Or, with firestore:</p>
<div class="gatsby-highlight">
      <pre class="language-js"><code class="language-js"><span class="token keyword">function</span> <span class="token operator">*</span> <span class="token function">rootSaga</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">yield</span> <span class="token function">fork</span><span class="token punctuation">(</span>
    rsf<span class="token punctuation">.</span>firestore<span class="token punctuation">.</span>syncCollection<span class="token punctuation">,</span>
    <span class="token string">'todos'</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span> successActionCreator<span class="token punctuation">:</span> setTodos <span class="token punctuation">}</span>
  <span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre>
      </div>
<div class="ui info message">
  <p class="header">Realtime DB <=> Firestore</p>
  <p>
    We'll use the realtime database for the rest of this guide but the strategies described below work exactly the same using firestore.
  </p>
</div>
<div class="ui warning message">
  <p class="header">Effect creators</p>
  <p>
    If you're not sure why we use <code>yield fork(rsf.database.sync, ...)</code> instead of simply <code>yield rsf.database.sync(...)</code> in the examples above then you should read <a href="https://redux-saga.js.org/docs/basics/DeclarativeEffects.html">redux-saga's docs</a> before continuing with this guide.
  </p>
</div>
<p>In the above, when <code>rootSaga</code> starts, it starts an <em>attached fork</em> which runs <code>rsf.database.sync</code> "in the background".
This means that <code>rootSaga</code> isn't blocked by the <code>yield fork(...)</code> line and, when it stops, so does <code>rsf.database.sync</code>.</p>
<p>Since <code>rootSaga</code> is redux-saga's root saga it will never stop and so, in the above example, the synchronization process will never stop.</p>
<p>But what if I need to pause the sync process and restart it later?</p>
<h2>Responding to actions</h2>
<p>Now let's assume we have two actions being dispatched by another part of the system (ie. the user pressing buttons): <code>RESUME_SYNC</code> and <code>PAUSE_SYNC</code>.</p>
<p>First, once we have a sync saga running, how can we take <code>PAUSE_SYNC</code> into account to pause the sync process?
Let's list what needs to happen in the root saga:</p>
<ul>
<li>start the sync saga</li>
<li>wait for a <code>PAUSE_SYNC</code> action</li>
<li>stop the sync saga</li>
</ul>
<p>To implement this we can use <a href="https://redux-saga.js.org/docs/advanced/TaskCancellation.html">tasks</a>.
Task objects represent running sagas and we can use them to stop a saga running the background.</p>
<p>Using the <a href="https://redux-saga.js.org/docs/api/#takepattern"><code>take</code> effect creator</a> to wait for the pause action and the <a href="https://redux-saga.js.org/docs/api/#canceltask"><code>cancel</code> effect creator</a> to cancel the running task we get:</p>
<div class="gatsby-highlight">
      <pre class="language-js"><code class="language-js"><span class="token keyword">function</span> <span class="token operator">*</span> <span class="token function">rootSaga</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// Start the sync saga</span>
  <span class="token keyword">const</span> task <span class="token operator">=</span> <span class="token keyword">yield</span> <span class="token function">fork</span><span class="token punctuation">(</span>
    rsf<span class="token punctuation">.</span>database<span class="token punctuation">.</span>sync<span class="token punctuation">,</span>
    <span class="token string">'todos'</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span> successActionCreator<span class="token punctuation">:</span> setTodos <span class="token punctuation">}</span>
  <span class="token punctuation">)</span>

  <span class="token comment">// Wait for the pause action</span>
  <span class="token keyword">yield</span> <span class="token function">take</span><span class="token punctuation">(</span><span class="token string">'PAUSE_SYNC'</span><span class="token punctuation">)</span>

  <span class="token comment">// Stop the sync saga</span>
  <span class="token keyword">yield</span> <span class="token function">cancel</span><span class="token punctuation">(</span>task<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre>
      </div>
<p>Now what about restarting?
We need to:</p>
<ul>
<li>start the sync saga</li>
<li>wait for a <code>PAUSE_SYNC</code> action</li>
<li>stop the sync saga</li>
<li>wait for a <code>RESUME_SYNC</code> action</li>
<li>restart the sync saga</li>
</ul>
<p>Or, to be able to pause/resume sync as many times as we want:</p>
<ul>
<li>
<p>infinite loop:</p>
<ul>
<li>start the sync saga</li>
<li>wait for a <code>PAUSE_SYNC</code> action</li>
<li>stop the sync saga</li>
<li>wait for a <code>RESUME_SYNC</code> action</li>
</ul>
</li>
</ul>
<div class="ui info message">
  <p class="header">Inifinite loops in saga</p>
  <p>
    Note that it's ok to have an infinite loop here because <code>yield</code> gives back control while waiting so we don't actually use up all CPU cycles. 😉
  </p>
</div>
<p>So we end up with:</p>
<div class="gatsby-highlight">
      <pre class="language-js"><code class="language-js"><span class="token keyword">function</span> <span class="token operator">*</span> <span class="token function">rootSaga</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// Start the sync saga</span>
    <span class="token keyword">let</span> task <span class="token operator">=</span> <span class="token keyword">yield</span> <span class="token function">fork</span><span class="token punctuation">(</span>
      rsf<span class="token punctuation">.</span>database<span class="token punctuation">.</span>sync<span class="token punctuation">,</span>
      <span class="token string">'todos'</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span> successActionCreator<span class="token punctuation">:</span> setTodos <span class="token punctuation">}</span>
    <span class="token punctuation">)</span>

    <span class="token comment">// Wait for the pause action, then stop sync</span>
    <span class="token keyword">yield</span> <span class="token function">take</span><span class="token punctuation">(</span><span class="token string">'PAUSE_SYNC'</span><span class="token punctuation">)</span>
    <span class="token keyword">yield</span> <span class="token function">cancel</span><span class="token punctuation">(</span>task<span class="token punctuation">)</span>

    <span class="token comment">// Wait for the resume action</span>
    <span class="token keyword">yield</span> <span class="token function">take</span><span class="token punctuation">(</span><span class="token string">'RESUME_SYNC'</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
      </div>
<p>That's a perfectly fine saga, but what if we want to sync user-specific data (ie. not always at <code>todos</code>)? 🤔</p>
<h2>Syncing user data</h2>
<p>Let's now synchronize our user's notifications stored in <code>notifications/:userId</code>.</p>
<p>The actions we're going to listen for are slightly different: <code>LOGIN</code> and <code>LOGOUT</code> instead of <code>SYNC_RESUME</code> and <code>SYNC_PAUSE</code>, but they essentially serve the same purpose.
We also won't start the sync process automatically when the application starts anymore.</p>
<p>We only need a couple changes to get this to work:</p>
<div class="gatsby-highlight">
      <pre class="language-js"><code class="language-js"><span class="token keyword">function</span> <span class="token operator">*</span> <span class="token function">rootSaga</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// Wait for a user to login</span>
    <span class="token keyword">const</span> loginAction <span class="token operator">=</span> <span class="token keyword">yield</span> <span class="token function">take</span><span class="token punctuation">(</span><span class="token string">'LOGIN'</span><span class="token punctuation">)</span>

    <span class="token comment">// Start the sync saga</span>
    <span class="token keyword">let</span> task <span class="token operator">=</span> <span class="token keyword">yield</span> <span class="token function">fork</span><span class="token punctuation">(</span>
      rsf<span class="token punctuation">.</span>database<span class="token punctuation">.</span>sync<span class="token punctuation">,</span>
      <span class="token template-string"><span class="token string">`notifications/</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>loginAction<span class="token punctuation">.</span>userId<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">`</span></span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span> successActionCreator<span class="token punctuation">:</span> syncNotifications <span class="token punctuation">}</span>
    <span class="token punctuation">)</span>

    <span class="token comment">// Wait for the logout action, then stop sync</span>
    <span class="token keyword">yield</span> <span class="token function">take</span><span class="token punctuation">(</span><span class="token string">'LOGOUT'</span><span class="token punctuation">)</span>
    <span class="token keyword">yield</span> <span class="token function">cancel</span><span class="token punctuation">(</span>task<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
      </div>
<p>So what changed?</p>
<ul>
<li>waiting for <code>RESUME_SYNC</code>/<code>LOGIN</code> was moved to the start of loop to make sure we don't automatically start syncing when the app starts</li>
<li>the <code>sync</code>ed path (<code>notifications/${loginAction.userId}</code>) now depends on the content of the action that's returned by <code>yield take('LOGIN')</code></li>
</ul>
<div class="ui warning message">
  <p class="header">Permissions in firebase</p>
  <p>
    When configured correctly, firebase won't let any random user read data from <code>notifications/123</code>, only a user logged in with id 123 will be able to read that.
  </p>
  <p>
    So, if you forget to stop the synchronisation saga for <code>notifications/123</code> when user 123 logs out, you'll start seeing permission errors in the console because you're no longer allowed to access this data.
  </p>
  <p>
    <strong>Don't forget to stop background saga when you don't need them anymore!</strong>
  </p>
  <p>
    For more details, check out <a href="https://github.com/n6g7/redux-saga-firebase/issues/92">issue #92</a>.
  </p>
</div>
<p>And that's it!</p>
<p>This should work as expected when users log in and out, however we've kinda been re-inventing the wheel here, let's see how we can refactor this.</p>
<h2>Refactor</h2>
<p>Let's start by extracting our code to a separate saga:</p>
<div class="gatsby-highlight">
      <pre class="language-diff"><code class="language-diff">  function * rootSaga () {
<span class="token inserted">+   yield fork(syncSaga)</span>
<span class="token inserted">+   // other stuff</span>
<span class="token inserted">+ }</span>
<span class="token inserted">+</span>
<span class="token inserted">+ function * syncSaga () {</span>
    while (true) {
      // Wait for a user to login
      const loginAction = yield take('LOGIN')

      // Start the sync saga
      let task = yield fork(
        rsf.database.sync,
        `notifications/${loginAction.userId}`,
        { successActionCreator: syncNotifications }
      )

      // Wait for the logout action, then stop sync
      yield take('LOGOUT')
      yield cancel(task)
    }
  }
</code></pre>
      </div>
<p>It's a small change but it allows us to start several sagas from <code>rootSaga</code> and to move <code>syncSaga</code> to another file if necessary.</p>
<p>Then let's rewrite our code using <a href="https://redux-saga.js.org/docs/api/#takelatestpattern-saga-args"><code>takeLatest</code></a>.</p>
<p>Essentially, <code>takeLatest</code> starts a saga whenever an action is dispatched, so we could use it to start <code>syncSaga</code> whenever <code>LOGIN</code> is dispatched and get rid of this distasteful <code>while(true)</code> loop:</p>
<div class="gatsby-highlight">
      <pre class="language-js"><code class="language-js"><span class="token keyword">function</span> <span class="token operator">*</span> <span class="token function">rootSaga</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">yield</span> <span class="token function">takeLatest</span><span class="token punctuation">(</span><span class="token string">'LOGIN'</span><span class="token punctuation">,</span> syncSaga<span class="token punctuation">)</span>
  <span class="token comment">// other stuff</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token operator">*</span> <span class="token function">syncSaga</span> <span class="token punctuation">(</span>action<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// Start the sync saga</span>
  <span class="token keyword">let</span> task <span class="token operator">=</span> <span class="token keyword">yield</span> <span class="token function">fork</span><span class="token punctuation">(</span>
    rsf<span class="token punctuation">.</span>database<span class="token punctuation">.</span>sync<span class="token punctuation">,</span>
    <span class="token template-string"><span class="token string">`notifications/</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>action<span class="token punctuation">.</span>userId<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">`</span></span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span> successActionCreator<span class="token punctuation">:</span> syncNotifications <span class="token punctuation">}</span>
  <span class="token punctuation">)</span>

  <span class="token comment">// Wait for the logout action, then stop sync</span>
  <span class="token keyword">yield</span> <span class="token function">take</span><span class="token punctuation">(</span><span class="token string">'LOGOUT'</span><span class="token punctuation">)</span>
  <span class="token keyword">yield</span> <span class="token function">cancel</span><span class="token punctuation">(</span>task<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre>
      </div>
<p>No need to wait for <code>LOGIN</code> manually anymore, and no need to think about this infinite loop either!</p>
<h2>Conclusion</h2>
<p>Learnings:</p>
<ul>
<li><code>fork</code>ed sagas run "in the background" and aren't blocking</li>
<li><a href="https://redux-saga.js.org/docs/api/#task">task</a> objects let us start and stop background sagas (ie. data synchronization sagas)</li>
<li>high level effect creators (<code>takeEvery</code>, <code>takeLatest</code>) save time and prevent headaches, use them!</li>
</ul>
<p>For more details, check out <a href="https://github.com/n6g7/redux-saga-firebase/issues/92">issue #92</a>.</p></div><footer class="ui center aligned container sc-bdVaJa iRtXIr"><a href="https://github.com/n6g7/redux-saga-firebase/tree/master/docs/guides/syncing-data.md" target="blank" class="ui basic button" role="button">Edit on GitHub</a></footer></div></div></div></div></div><script id="webpack-manifest">/*<![CDATA[*/window.webpackManifest={"231608221292675":"app-f3a296a33b4cd35f3b2c.js","18514657622563":"component---src-layouts-guide-js-a595dc229e1f595c8f3f.js","259663948497532":"component---src-layouts-reference-js-989fa81da17dbd0b1779.js","162898551421021":"component---src-pages-404-js-4503918ea3a16cfcdb75.js","35783957827783":"component---src-pages-index-js-9ec9a415d7c7d776d557.js","218538773642512":"component---src-pages-page-2-js-075954cd9c4544c7dcd8.js","60335399758886":"path----a0cae3d3abc4fbacfa6e.js","230794531105186":"path---guides-custom-keys-83c061e100f4752e4d44.js","1579769163079":"path---guides-multiple-apps-417e74bd0fb95f1a0a85.js","71904975636495":"path---guides-immutable-499f7900e0ae42b0f763.js","85549614654720":"path---guides-sorting-filtering-429e8bfceac03f8e9af7.js","84530823256904":"path---guides-syncing-data-d377eb2c5ef2ff9d3444.js","52603989620341":"path---reference-auth-7aee2540b380e13649a1.js","21280139501707":"path---reference-database-896a38cf701fe54fda6c.js","100953447911472":"path---reference-functions-02479115b09641d4ca4b.js","33615249830105":"path---reference-firestore-92331515535299e270c8.js","245237687190721":"path---reference-messaging-4cf83dfff07a33f23487.js","210276329909460":"path---reference-storage-662b9f5e6138fe4b0cd8.js","254022195166212":"path---404-a0e39f21c11f6a62c5ab.js","142629428675168":"path---index-a0e39f21c11f6a62c5ab.js","135728916539164":"path---page-2-a0e39f21c11f6a62c5ab.js","178698757827068":"path---404-html-a0e39f21c11f6a62c5ab.js","114276838955818":"component---src-layouts-index-js-09b7634bc0de54fb20dc.js"}/*]]>*/</script><script>
  
  if(true) {
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
  }
  if (typeof ga === "function") {
    ga('create', 'UA-62266834-3', 'auto');
      }
      </script><script>/*<![CDATA[*/!function(e,t,r){function n(){for(;d[0]&&"loaded"==d[0][f];)c=d.shift(),c[o]=!i.parentNode.insertBefore(c,i)}for(var s,a,c,d=[],i=e.scripts[0],o="onreadystatechange",f="readyState";s=r.shift();)a=e.createElement(t),"async"in i?(a.async=!1,e.head.appendChild(a)):i[f]?(d.push(a),a[o]=n):e.write("<"+t+' src="'+s+'" defer></'+t+">"),a.src=s}(document,"script",["/redux-saga-firebase/commons-95f0d9279a1f8fa48b42.js","/redux-saga-firebase/app-f3a296a33b4cd35f3b2c.js","/redux-saga-firebase/path---guides-syncing-data-d377eb2c5ef2ff9d3444.js","/redux-saga-firebase/component---src-layouts-guide-js-a595dc229e1f595c8f3f.js","/redux-saga-firebase/component---src-layouts-index-js-09b7634bc0de54fb20dc.js"])/*]]>*/</script></body></html>